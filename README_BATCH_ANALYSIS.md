# 批量股票分析功能

## 功能概述

批量股票分析功能允许用户同时分析多只股票，支持多种分析维度和AI智能分析，提供完整的进度监控和错误处理机制。

## 主要特性

### 🎯 多维度分析
- **基本面分析**: 股票基本信息、财务数据、公司概况
- **技术面分析**: K线数据、技术指标、趋势分析
- **新闻面分析**: 相关新闻资讯、市场情绪分析
- **筹码面分析**: 筹码分布、成本分析
- **综合分析**: AI智能综合分析，整合多维度信息

### ⚙️ 灵活配置
- 支持手动输入、示例选择、文件导入等多种股票列表配置方式
- 可自定义分析类型组合
- 支持缓存控制和强制刷新
- 可配置并发线程数和重试次数
- 支持用户观点输入，AI将结合用户观点进行分析

### 📊 实时监控
- 实时进度显示和状态更新
- 详细的错误日志和分类处理
- 自动重试机制和错误恢复
- 分析统计和性能指标

### 📁 结果管理
- 自动生成详细的分析报告
- 支持CSV和JSON格式导出
- 历史记录管理和查看
- 汇总统计和可视化展示

## 使用方法

### 1. Web界面使用

1. 启动应用后，在侧边栏选择"批量分析"
2. 在"配置分析"标签页中：
   - 选择股票列表配置方式
   - 选择要执行的分析类型
   - 配置高级参数（缓存、AI分析、并发数等）
   - 保存配置
3. 在"执行分析"标签页中：
   - 查看配置摘要
   - 点击"开始批量分析"按钮
   - 实时查看分析进度
4. 在"查看结果"标签页中：
   - 查看分析结果汇总
   - 下载结果文件
   - 查看统计图表
5. 在"历史记录"标签页中：
   - 查看历史分析记录
   - 重新查看历史结果

### 2. 命令行使用

```bash
# 完整分析模式（分析所有配置的股票）
python daily_xystock_report.py

# 快速分析模式（只分析前5只股票）
python daily_xystock_report.py --mode quick

# 指定股票代码分析
python daily_xystock_report.py --mode quick --stocks 000001 600519 300750

# 指定分析类型
python daily_xystock_report.py --mode quick --types basic technical
```

### 3. 编程接口使用

```python
from stock.batch_analysis import BatchStockAnalyzer, BatchAnalysisConfig

# 创建分析配置
config = BatchAnalysisConfig(
    stock_codes=["000001", "600519", "300750"],
    analysis_types=['basic', 'technical', 'comprehensive'],
    use_cache=True,
    include_ai_analysis=True,
    max_workers=3
)

# 执行批量分析
analyzer = BatchStockAnalyzer()
result = analyzer.batch_analyze(config)

# 查看结果
print(f"成功: {result.success_count}, 失败: {result.failed_count}")
```

## 配置说明

### 分析类型
- `basic`: 基本面分析
- `technical`: 技术面分析
- `news`: 新闻面分析
- `chip`: 筹码面分析
- `comprehensive`: 综合分析

### 高级配置
- `use_cache`: 是否使用缓存数据（默认True）
- `force_refresh`: 是否强制刷新数据（默认False）
- `include_ai_analysis`: 是否启用AI分析（默认True）
- `max_workers`: 并发线程数（默认3）
- `max_retry`: 最大重试次数（默认2）

## 输出文件

### 结果目录结构
```
batch_analysis_results/
└── 20241201_143022/
    ├── batch_analysis_summary_20241201_143022.csv    # 汇总CSV
    ├── batch_analysis_detailed_20241201_143022.json  # 详细JSON
    ├── monitor_log.json                              # 监控日志
    ├── 000001_平安银行_20241201_143022.json          # 单只股票报告
    ├── 600519_贵州茅台_20241201_143022.json
    └── ...
```

### 文件说明
- **汇总CSV**: 包含所有股票的分析结果摘要
- **详细JSON**: 包含完整的分析配置和结果数据
- **监控日志**: 包含分析过程的详细监控信息
- **单只股票报告**: 每只股票的详细分析数据

## 错误处理

### 错误分类
- **网络错误**: 自动重试，延迟5秒
- **数据错误**: 不重试，记录错误信息
- **AI错误**: 自动重试，延迟10秒
- **超时错误**: 自动重试，延迟3秒
- **未知错误**: 不重试，记录详细信息

### 错误恢复
- 自动重试机制
- 错误分类处理
- 详细错误日志
- 失败股票统计

## 性能优化

### 并发控制
- 默认3个并发线程
- 可根据系统性能调整
- 避免过度并发导致API限制

### 缓存机制
- 智能缓存管理
- 减少重复数据获取
- 提高分析效率

### 监控优化
- 实时进度更新
- 定期状态报告
- 性能指标统计

## 注意事项

1. **API限制**: 注意数据源的API调用限制，合理设置并发数
2. **网络稳定性**: 确保网络连接稳定，避免分析中断
3. **存储空间**: 批量分析会产生大量数据，确保有足够的存储空间
4. **分析时间**: 大量股票分析需要较长时间，建议合理安排
5. **AI分析**: AI分析需要额外的API调用，注意相关费用

## 故障排除

### 常见问题
1. **股票代码无效**: 检查股票代码格式和有效性
2. **网络连接失败**: 检查网络连接和代理设置
3. **API调用失败**: 检查API密钥和配额限制
4. **内存不足**: 减少并发数或分批分析
5. **分析超时**: 增加超时时间或减少分析类型

### 日志查看
- 查看控制台输出的详细日志
- 检查监控日志文件了解详细过程
- 查看错误摘要了解失败原因

## 更新日志

### v1.0.0 (2024-12-01)
- 初始版本发布
- 支持多维度股票分析
- 集成AI智能分析
- 完整的监控和错误处理
- Web界面和命令行支持
